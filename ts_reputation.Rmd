---
title: "Taylor's Reputation: Sentiment Analysis to Determine Selective Exposure to Information about Taylor Swift's Negativity"
author: "Carson Zhang (cxzhang4)"
date: "5/11/2020"
output:
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
```

```{r}
# code used to collect data from Genius
# artists and albums manually collected from Wikipedia

# library(genius)

# artist_albums <- tribble(
#  ~artist, ~album,
#  "Taylor Swift", "Taylor Swift",
#  "Taylor Swift", "Fearless",
#  "Taylor Swift", "Speak Now",
#  "Taylor Swift", "Red",
#  "Taylor Swift", "1989",
#  "Taylor Swift", "reputation",
#  "Taylor Swift", "Lover",
#  "Beyonce", "Dangerously in Love",
#  "Beyonce", "B'Day",
#  "Beyonce", "I Am... Sasha Fierce",
#  "Beyonce", "4",
#  "Beyonce", "Beyonce",
#  "Beyonce", "Lemonade",
#  "Britney Spears", "...Baby One More Time",
#  "Britney Spears", "Oops!... I Did It Again",
#  "Britney Spears", "Britney",
#  "Britney Spears", "In the Zone",
#  "Britney Spears", "Blackout",
#  "Britney Spears", "Circus",
#  "Britney Spears", "Femme Fatale",
#  "Britney Spears", "Britney Jean",
#  "Britney Spears", "Glory",
#  "Nicki Minaj", "Pink Friday",
#  "Nicki Minaj", "Pink Friday: Roman Reloaded",
#  "Nicki Minaj", "The Pinkprint",
#  "Nicki Minaj", "Queen",
#  "Adele", "19",
#  "Adele", "21",
#  "Adele", "25",
#  "Katy Perry", "Katy Hudson",
#  "Katy Perry", "One of the Boys",
#  "Katy Perry", "Teenage Dream",
#  "Katy Perry", "Prism",
#  "Katy Perry", "Witness",
#  "Lady Gaga", "The Fame Monster",
#  "Lady Gaga", "Born This Way",
#  "Lady Gaga", "Artpop",
#  "Lady Gaga", "Joanne",
#  "Lady Gaga", "Chromatica",
#  "Mariah Carey", "Mariah Carey",
#  "Mariah Carey", "Emotions",
#  "Mariah Carey", "Music Box",
#  "Mariah Carey", "Daydream",
#  "Mariah Carey", "Butterfly",
#  "Mariah Carey", "Rainbow",
#  "Mariah Carey", "Glitter",
#  "Mariah Carey", "Charmbracelet",
#  "Mariah Carey", "The Emancipation of Mimi",
#  "Mariah Carey", "E=MC2",
#  "Mariah Carey", "Memoirs of an Imperfect Angel",
#  "Mariah Carey", "Me. I Am Mariah... The Elusive Chanteuse",
#  "Mariah Carey", "Caution",
#  "Whitney Houston", "Whitney Houston",
#  "Whitney Houston", "Whitney",
#  "Whitney Houston", "I'm Your Baby Tonight",
#  "Whitney Houston", "My Love Is Your Love",
#  "Whitney Houston", "Just Whitney...",
#  "Whitney Houston", "I Look to You",
#  "Celine Dion", "Unison",
#  "Celine Dion", "Celine Dion",
#  "Celine Dion", "The Colour of My Love",
#  "Celine Dion", "Falling into You",
#  "Celine Dion", "Let's Talk About Love",
#  "Celine Dion", "These Are Special Times",
#  "Celine Dion", "A New Day Has Come",
#  "Celine Dion", "One Heart",
#  "Celine Dion", "Miracle",
#  "Celine Dion", "Taking Chances",
#  "Celine Dion", "Loved Me Back to Life",
#  "Celine Dion", "Courage",
#  "Madonna", "Madonna",
#  "Madonna", "Like a Virgin",
#  "Madonna", "True Blue",
#  "Madonna", "Like a Prayer",
#  "Madonna", "Erotica",
#  "Madonna", "Bedtime Stories",
#  "Madonna", "Ray of Light",
#  "Madonna", "Music",
#  "Madonna", "American Life",
#  "Madonna", "Confessions on a Dance Floor",
#  "Madonna", "Hard Candy",
#  "Madonna", "MDNA",
#  "Madonna", "Rebel Heart",
#  "Madonna", "Madame X",
 # "Rihanna", "Music of the Sun",
 # "Rihanna", "A Girl like Me",
 # "Rihanna", "Good Girl Gone Bad: Reloaded",
 # "Rihanna", "Rated R",
 # "Rihanna", "Loud",
 # "Rihanna", "Talk That Talk",
 # "Rihanna", "Unapologetic",
 # "Rihanna", "Anti"
# )

# artist_albums = tribble(
#         ~artist, ~album,
#         "Taylor Swift", "Lover"
# )


# female_pop_star_lyrics = artist_albums %>%
#  add_genius(artist, album)

# write_csv(female_pop_star_lyrics, "female_pop_star_lyrics.csv")
```

```{r}
library(tidyverse)
library(tidytext)
library(gridExtra)
library(broom)
```

```{r}
female_pop_star_lyrics = read_csv("data/female_pop_star_lyrics.csv")

# pre-processing: each row now contains a single word because
# we perform basic sentiment analysis at the word level
fps_lyrics_tidy = female_pop_star_lyrics %>% 
  unnest_tokens(word, lyric)
```

```{r}
# compute overall sentiment of each song using AFINN
fps_afinn = fps_lyrics_tidy %>%
  inner_join(get_sentiments("afinn")) %>%
  group_by(index = track_title) %>%
  summarise(sentiment = sum(value)) %>%
  mutate(method = "AFINN")

# compute overall sentiment of each song using Bing and NRC
fps_bing_and_nrc = bind_rows(fps_lyrics_tidy %>%
                              inner_join(get_sentiments("bing")) %>%
                              mutate(method = "Bing"),
                            fps_lyrics_tidy %>% 
                              inner_join(get_sentiments("nrc")) %>%
                                filter(sentiment %in% c("positive", "negative")) %>%
                              mutate(method = "NRC")) %>%
  count(method, index = track_title, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)

# combine all of the results
fps_all = bind_rows(fps_afinn, fps_bing_and_nrc)
```

```{r}
artists_albums = female_pop_star_lyrics %>% 
  select(artist, track_title) %>% distinct()

# add the album that each track comes from
fps_all_albums = fps_all %>% 
  inner_join(artists_albums, by = c("index" = "track_title"))

# transform the data: each song only has one row
# each sentiment value (AFINN, Bing, NRC) is its own variable (column)
afinn_pivoted = fps_all_albums %>% 
  filter(method == "AFINN") %>% 
  pivot_wider(names_from = method, values_from = sentiment)
bing_pivoted = fps_all_albums %>% 
  filter(method == "Bing") %>% 
  pivot_wider(names_from = method, values_from = sentiment)
nrc_pivoted = fps_all_albums %>% 
  filter(method == "NRC") %>% 
  pivot_wider(names_from = method, values_from = sentiment)

fps_pivoted = afinn_pivoted %>% 
  inner_join(bing_pivoted, by = c("index", "artist")) %>% 
  inner_join(nrc_pivoted, by = c("index", "artist"))
```

```{r}
fps_condensed = fps_pivoted %>% 
  select(index, artist, AFINN, Bing, NRC)
```

```{r}
artist_song_counts = fps_condensed %>% count(artist)
```

```{r}
# used to highlight a specific artist on a barplot
artist_highlight_bar = function() {
        list(geom_bar(stat = "identity"),
             coord_flip(),
             scale_fill_manual(values = c("yes" = "tomato", "no" = "gray"),
                               guide = FALSE)
        )
}

# used to plot proportions
prop_aes = aes(x = reorder(artist, prop), y = prop, fill = highlight)
# used to plot raw numbers
n_aes = aes(x = reorder(artist, n.x), y = n.x, fill = highlight)
```

```{r}
fps_totals = fps_condensed %>% 
  group_by(artist) %>% 
  summarise(AFINN_total = sum(AFINN), Bing_total = sum(Bing), NRC_total = sum(NRC))

fps_props = fps_totals %>%
  inner_join(artist_song_counts, by = "artist") %>% 
  mutate(AFINN_rate = AFINN_total / n, 
         Bing_rate = Bing_total / n, 
         NRC_rate = NRC_total / n)
```

```{r}
# used to transform dataframe to highlight a specific artist when plotting
highlight_artist = function(df, artist_name) {
  df %>% 
    mutate(highlight = ifelse(artist == artist_name, "yes", "no")) %>%
    return()
}
```

## Introduction

## Method

### Data collection

We define the population that Taylor Swift comes from as popular female artists.

Specifically, an artist is sufficiently popular if they have sold over 200 million records. We analyze popular artists because we hypothesize that the belief arises from overfitting based on a small number of popular songs. Therefore, we want the artists in our population to be reasonable candidates for the same belief and belief-generating process. We choose 200 million as the cutoff because that is the lower bound of the group that Taylor Swift is in on Wikipedia's list of best-selling musical artists.

We choose to only analyze female artists because I believe that women are perceived differently from men. I claim that societal perceptions of momen's roles in romantic relationships are different from men's roles, so we restrict our analysis to women in order to control for these differences.

```{r}
n_artists = artist_song_counts %>% nrow()
n_songs = artist_song_counts$n %>% sum()
```

This results in a population of `r n_artists` artists who have recorded `r n_songs`.

Lyrics were collected from Genius using the “genius” R package. Genius was chosen as a data source because of its frequent collaborations with popular artists, suggesting that it contains at least some official lyrics, and not simply crowdsourced lyrics.

### Data preprocessing

As collected, the dataset had one song line per row. Because we are performing sentiment analysis at the word level, tokens were unnested so that each row contained a single word.

Notably, no stop words were removed. This is because the existence of stop words is already accounted for by the sentiment dictionaries: if a word does not indicate a sentiment, it simply will not exist in the dictionary, and therefore will not affect the sentiment of the document.

### Metrics for analysis

We identify three major ways to evaluate whether the belief is reasonable.

The distribution of Taylor Swift's sentiments might be different from other similar artists. If this is the case, we can conclude that Taylor Swift's songwriting process is different from the other artists. If the belief is reasonable, this should be the case.

Taylor Swift might be more negative overall than other similar artists. Therefore, we compute the overall sentiment of each artist's discography, divide by the size of their discography to obtain a "rate", and rank them. If Taylor Swift is in fact more negative on average, then her rank should be low. If this is the case, then the belief could be reasonable.

Taylor Swift might write a larger proportion of very negative songs. Therefore, we compute this proportion for each artist and rank them. If this is the case, then the belief could be reasonable. 

## Results

The below plots display, for each sentiment dictionary, each artist ranked from highest to worst in standardized sentiment.

```{r echo=FALSE}
fps_props %>%
  highlight_artist("Taylor Swift") %>%
  ggplot(aes(x = reorder(artist, AFINN_rate), y = AFINN_rate, fill = highlight)) +
  artist_highlight_bar() +
  ggtitle("Figure 1: Artists ranked by AFINN (standardized)")

fps_props %>%
  highlight_artist("Taylor Swift") %>%
  ggplot(aes(x = reorder(artist, Bing_rate), y = Bing_rate, fill = highlight)) +
  artist_highlight_bar() +
  ggtitle("Figure 2: Artists ranked by Bing (standardized)")

fps_props %>%
  highlight_artist("Taylor Swift") %>%
  ggplot(aes(x = reorder(artist, NRC_rate), y = NRC_rate, fill = highlight)) +
  artist_highlight_bar() +
  ggtitle("Figure 3: Artists ranked by NRC (standardized)")
```

We observe that Taylor Swift ranks at or below the median in all sentiment measures. This could be considered a low overall ranking. However, she is always within the interquartile range: her lowest rank is in NRC: 9th out of 12 (Figure 3). This could be considered an average overall ranking.

<!-- Furthermore, in Figure 1 there is no clear grouping of artists. The AFINN values decline quite steadily from highest to lowest. -->

<!-- In Figure 2, she ranks in the middle. She is clearly not one of the most positive, but it is unclear how typical she is: one could argue that she is in a lower (i.e. more negative) group of artists. -->

Thus, the overall sentiment ranks are inconclusive without a definition of what absolute sentiment value is considered "low".

Therefore, the overall sentiment ranks do not support the belief that Taylor Swift's lyrics are anomalously negative; I am comfortable claiming that she is more negative than average, but within the typical range.

```{r}
# fps_condensed %>%
#   ggplot(aes(AFINN, color = artist)) +
#   geom_freqpoly(binwidth = 20) +
#   ggtitle("AFINN distribution by artist")
# 
# fps_condensed %>%
#   ggplot(aes(Bing, color = artist)) +
#   geom_freqpoly(binwidth = 20) +
#   ggtitle("Bing distribution by artist")
# 
# fps_condensed %>%
#   ggplot(aes(NRC, color = artist)) +
#   geom_freqpoly(binwidth = 20) +
#   ggtitle("NRC distribution by artist")
```

```{r}
songs_less_point05 = fps_condensed %>% 
  mutate(AFINN_cdf = cume_dist(AFINN), 
         Bing_cdf = cume_dist(Bing), 
         NRC_cdf = cume_dist(NRC)) %>%
  filter(AFINN_cdf < 0.05 & Bing_cdf < 0.05 & NRC_cdf < 0.05)
```

```{r}
songs_less_point1 = fps_condensed %>% 
  mutate(AFINN_cdf = cume_dist(AFINN), Bing_cdf = cume_dist(Bing), NRC_cdf = cume_dist(NRC)) %>%
  filter(AFINN_cdf < 0.1 & Bing_cdf < 0.1 & NRC_cdf < 0.1)
```

```{r}
less_point05_with_prop = fps_condensed %>%
  mutate(AFINN_cdf = cume_dist(AFINN), 
         Bing_cdf = cume_dist(Bing), 
         NRC_cdf = cume_dist(NRC)) %>%
  filter(AFINN_cdf < 0.05 & Bing_cdf < 0.05 & NRC_cdf < 0.05) %>%
  count(artist) %>%
  inner_join(artist_song_counts, by = "artist") %>%
  mutate(prop = n.x / n.y )%>% 
  mutate(highlight = ifelse(artist == "Taylor Swift", "yes", "no"))

less_point1_with_prop = fps_condensed %>%
  mutate(AFINN_cdf = cume_dist(AFINN), 
         Bing_cdf = cume_dist(Bing), 
         NRC_cdf = cume_dist(NRC)) %>%
  filter(AFINN_cdf < 0.1 & Bing_cdf < 0.1 & NRC_cdf < 0.1) %>%
  count(artist) %>%
  inner_join(artist_song_counts, by = "artist") %>%
  mutate(prop = n.x / n.y )%>% 
  mutate(highlight = ifelse(artist == "Taylor Swift", "yes", "no"))
```

The below plots display each artist from highest to lowest in proportion of very negative songs. We have defined "very negative song" as: a song that ranks in the bottom (5 or 10)% in all three sentiment dictionaries. Artists with 0 songs that fit this criteria do not appear in the plots.

```{r echo=FALSE}
less_point1_with_prop %>%
  ggplot(prop_aes) +
  artist_highlight_bar() +
  ggtitle("Artists ranked by proportion of very negative songs (bottom 10% in all dicts)")

less_point05_with_prop %>%
  ggplot(prop_aes) +
  artist_highlight_bar() +
  ggtitle("Artists ranked by proportion of very negative songs (bottom 5% in all dicts)")
```

```{r}
less_point1_with_prop %>% filter(artist == "Taylor Swift") %>% select(n.x)
```

Taylor Swift ranks quite highly in proportion of songs in the bottom 10%. However, her proportion is not very different from Britney Spears, Mariah Carey, or Madonna. Furthermore, the proportion itself is quite small: under 5% of her discography, or 5 of Taylor Swift's songs, meet this criteria

Notably, Taylor Swift does not appear in the next plot. None of her songs are in the bottom 5% in all sentiment dictionaries.

Given the small absolute number, and the sensitivity of this metric to the cutoff you choose, this data does not support the belief. 

## T-tests

```{r}
artist_names = fps_condensed$artist %>% unique()
other_artists = artist_names[!(artist_names == "Taylor Swift")]
```

```{r}
# perform t-tests for AFINN
ts_afinn = ( fps_condensed %>% filter(artist == "Taylor Swift") )$AFINN
# store p-value for each t-test
afinn_pvals = vector("numeric", length = length(other_artists))
i = 1
for (other_artist in other_artists) {
  other_artist_afinn = ( fps_condensed %>% filter(artist == other_artist) )$AFINN
  
  test_result = t.test(ts_afinn, other_artist_afinn)
  # print(test_result$p.value)
  
  afinn_pvals[i] = test_result$p.value
  i = i + 1
}
```

```{r}
# perform t-tests for Bing
ts_bing = ( fps_condensed %>% filter(artist == "Taylor Swift") )$Bing
# store p-value for each t-test
bing_pvals = vector("numeric", length = length(other_artists))
i = 1
for (other_artist in other_artists) {
  other_artist_bing = ( fps_condensed %>% filter(artist == other_artist) )$Bing
  
  test_result = t.test(ts_bing, other_artist_bing)
  # print(test_result$p.value)
  
  bing_pvals[i] = test_result$p.value
  i = i + 1
}
```

```{r}
# perform t-tests for NRC
ts_NRC = ( fps_condensed %>% filter(artist == "Taylor Swift") )$NRC
# store p-values for each t-test
NRC_pvals = vector("numeric", length = length(other_artists))
i = 1
for (other_artist in other_artists) {
  other_artist_NRC = ( fps_condensed %>% filter(artist == other_artist) )$NRC
  
  test_result = t.test(ts_NRC, other_artist_NRC)
  # print(test_result$p.value)
  
  NRC_pvals[i] = test_result$p.value
  i = i + 1
}
```

```{r}
afinn_sig_idx = afinn_pvals < 0.05

mean(afinn_sig_idx)

sum(afinn_sig_idx)
```

```{r}
bing_sig_idx = bing_pvals < 0.05

mean(bing_sig_idx)

sum(bing_sig_idx)
```

```{r}
NRC_sig_idx = NRC_pvals < 0.05

mean(NRC_sig_idx)

sum(NRC_sig_idx)
```

```{r}
# afinn_sig_idx
# bing_sig_idx
# NRC_sig_idx
```

```{r}
sent_pvals = data.frame(AFINN = afinn_pvals, 
                        Bing = bing_pvals, 
                        NRC = NRC_pvals) %>% 
  as_tibble()

sent_pvals = data.frame(AFINN = afinn_pvals, 
                        Bing = bing_pvals, 
                        NRC = NRC_pvals, 
                        row.names = other_artists)
```

```{r}
# print values without scientific notation
options(scipen = 99999)

sent_pvals
```

```{r}
sent_pvals < 0.05
```

```{r}
sent_pvals < 0.1
```

## cite

Wikipedia

Hart et al

